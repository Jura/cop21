<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>COP21</title>

  <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
  <link rel="stylesheet" href="app.css" />

  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>-->
</head>

<body>
  
  <!--<div class="row">
    <div class="large-12 columns">
      <h1>COP21 map</h1>
    </div>
  </div>
  
  <div class="row">
    <div class="large-12 columns" id="map"></div>
  </div>-->
  <div id="map"></div>
  
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/fastclick.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
  
  <script>
    //$(document).foundation();
    
    var map = L.map('map').setView([30, 0], 3);
    
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 10,
        id: 'undporg.cig9rbehw004tuekrnt5bf253',
        accessToken: 'pk.eyJ1IjoidW5kcG9yZyIsImEiOiJjaWc5cmJmcWwwMDRxdjJrcjgxbnczaThvIn0.J-5uk4LED0EgvK1raqCJmg'
    }).addTo(map);
    
    var popup = L.popup().setContent('empty');
    
    $.getJSON('centroids.json').done(function(data){
      
      var widthMax = data.reduce(function(max, arr) {
          return max >= arr[1] ? max : arr[1];
      }, -Infinity);
      var widthMin = data.reduce(function(min, arr) {
          return arr[1] < min ? arr[1] : min;
      }, Infinity);
      //console.log(widthMax,widthMin);
      
      var markers = [];
      for (var i=0; i<data.length; i++) {
        markers.push(new L.circleMarker([data[i][2],data[i][3]], {weight:2, data: data[i]}).setRadius(data[i][1]/3 + 3).on('click', showpopup)); // Math.log(data[i][1]) * 5
      }
      var cLayer = L.layerGroup(markers).addTo(map);
    });
    
    function showpopup(e) {
      //console.log(e.);
      popup.setLatLng(e.latlng).setContent(e.target.options.data[0] + ': ' + e.target.options.data[1] + ' submission' + (e.target.options.data[1] % 10 == 1 ? '' : 's')); 
      map.openPopup(popup);
    }
  </script>
</body>

</html>